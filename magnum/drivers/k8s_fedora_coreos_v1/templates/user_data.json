{
  "ignition": {
    "version": "3.1.0"
  },
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "__SSH_KEY_VALUE__"
        ]
      }
    ]
  },
  "storage": {
    "directories": [
      {
        "group": {
          "name": "root"
        },
        "path": "/var/lib/cloud/data",
        "user": {
          "name": "root"
        },
        "mode": 493
      },
      {
        "group": {
          "name": "root"
        },
        "path": "/var/lib/heat-cfntools",
        "user": {
          "name": "root"
        },
        "mode": 493
      }
    ],
    "files": [
      {
        "path": "/etc/sysctl.d/max-user-watches.conf",
        "contents": {
          "source": "data:,fs.inotify.max_user_watches%3D16184%0A"
        }
      },
      {
        "path": "/etc/sysctl.d/reverse-path-filter.conf",
        "contents": {
          "source": "data:,net.ipv4.conf.default.rp_filter%3D0%0Anet.ipv4.conf.*.rp_filter%3D0%0A"
        }
      },
      {
        "path": "/etc/systemd/network/50-flannel.link",
        "contents": {
          "source": "data:,%5BMatch%5D%0AOriginalName%3Dflannel*%0A%5BLink%5D%0AMACAddressPolicy%3Dnone%0A"
        }
      },
      {
        "group": {
          "name": "root"
        },
        "overwrite": true,
        "path": "/etc/selinux/config",
        "user": {
          "name": "root"
        },
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/5SQv27zMAzE9zzFAVm/5AE+oFszFMifAkmBdjJUiY6JypQh0m799oUd2+nSoZooiXc/Hte4VKwoORJ8EsspKqwiqDkjpBLn3Z6l/UKS23uvRvV2tR4+no4vrw/wTmDug5BkVFhFSrAqE6FzsSX9v1pjOCRlyp7lis3iq+TbzNajSZF9D9apjcJ2kjWUa1bljn7omsxiik+XheWqYFEjF4YBFsxsEFjde6SADY7p7rAAY3JhwM2RimKqisPpcVcU97SXt+fdXxKby1eykXyZyyYnT6qkcJmGm5E3Cv8mSc3CdVtjg0MKXLJ3xklGzOIwTr7FSWIPpTjqf/Odl1BHHTzbaIw9dRRxXlZ/6+Ukyw7GoDNw9R0AAP//roYU6CcCAAA="
        },
        "mode": 420
      },
      {
        "group": {
          "name": "root"
        },
        "path": "/etc/containers/containers.conf",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:;base64,IyBNYXhpbXVtIHNpemUgb2YgbG9nIGZpbGVzIChpbiBieXRlcykKIyAtMSBpcyB1bmxpbWl0ZWQKIyA1MG0KbWF4X2xvZ19zaXplID0gNTI0Mjg4MDAK"
        },
        "mode": 420
      },
      {
        "group": {
          "name": "root"
        },
        "overwrite": true,
        "path": "/etc/hostname",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,__HOSTNAME__%0A"
        },
        "mode": 420
      },
      {
        "group": {
          "name": "root"
        },
        "path": "/etc/pki/ca-trust/source/anchors/openstack-ca.pem",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,__OPENSTACK_CA__%0A"
        },
        "mode": 420
      },
      {
        "group": {
          "name": "root"
        },
        "path": "/root/configure-agent-env.sh",
        "user": {
          "name": "root"
        },
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/5RUbW/bNhD+zl9xswcE2CbR3QYU2NoAxbagxYYkqDtgw9AJNHW2CEs8jndMog377wXpuHYcF24+UbqX54V30vQLvXBeLwx3SjEKVHebA8vxdVIqeXE9/AXVEjSK1WHttDWVxMSimVK0qI23HUXWFNCzGLuurKkDDvBetaQAANB2BJNb48T5FSwpPh1sUoC4RwzwHauWPCqlE8diIYXWCFZbMKVev3t33Vy/vfrjz5eTptm9Nc2k5OYPk/Nd9vJql9o+57hyy3wPHiZf/rfD+38C738E6dBvjN4FigK7/J79TiQ0IdLd+PIA4fx8cx/ob1wkP6AXtXSPGOenKOdHOfkB6fwprFv/xym32T0+Tx/J9no/xTSFnyIaQTCwxjEYF8tuSIfQoZHKkhfjPMbKrNALCKkpGGuRuRR5ahHoBiMwdzW8EXAMiXGZehACChiNoJqC89ARCwyUvIA3A3IwFsH4FkwI/QiW/NKtUjTiyNfKtWpYty5CFUBzvNGDWfk06Jq5U7YbqIXZ89nscW4qlGz3KK6zn6a4aCIbxdxVaxxX6KH6ByqByAaqSzg7K1+aDOGwY7g5Fj5JdLytDmlxqjXXbK1+f8TqIdPnlxbkKbxq2zLFkBa9s3lgZfB5TiZJR9H9i22zxpFh6Xqs9yYSieTxLPaiRj5HBJzvNekD0nuFPVnTZ01CsPZ022SBvB0gW+Ph2bfP61k9q59lvEPW3OPvm6Z5T+9Xbbtrxds3GX2BwAGtWzps4dZJV6qri+LmCPIGB168+OXqQr3OEovWTFW+SMixSzPgTuAm/jtjhOx78/qmRS9OxgvX48kpfwT4NfvKDHy8b993FqgYW6gcnOm/rzEOTt4SyW+0cl4Da6i/0sUzJamCYb6l2OqzzW8jwzF3bbNxrKYwR5uikxHQd8ZbzH+UH+Bnx2bRI2z7yxplb7bc9L6C+4pXDwpgRC5iyunpU/yKRxYcrPQQkcVEyZNq1YcAAAD//4k3yPxPBwAA"
        },
        "mode": 448
      },
      {
        "group": {
          "name": "root"
        },
        "path": "/etc/zincati/config.d/90-disable-auto-updates.toml",
        "user": {
          "name": "root"
        },
        "contents": {
          "source": "data:,%5Bupdates%5D%0Aenabled%20%3D%20false%0A"
        },
        "mode": 420
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Configure heat agent environment\nAfter=sshd.service\n\n[Service]\nUser=root\nGroup=root\nType=simple\nExecStart=/bin/bash /root/configure-agent-env.sh\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "configure-agent-env.service"
      },
      {
        "contents": "[Unit]\nDescription=Run heat-container-agent\nAfter=network-online.target configure-agent-env.service\nWants=network-online.target\n\n[Service]\nEnvironmentFile=-/etc/environment\nExecStartPre=mkdir -p /var/lib/heat-container-agent\nExecStartPre=mkdir -p /var/run/heat-config\nExecStartPre=mkdir -p /var/run/os-collect-config\nExecStartPre=mkdir -p /opt/stack/os-config-refresh\nExecStartPre=-mv /var/lib/os-collect-config/local-data /var/lib/cloud/data/cfn-init-data\nExecStartPre=mkdir -p /srv/magnum\nExecStartPre=-/bin/podman kill heat-container-agent\nExecStartPre=-/bin/podman rm heat-container-agent\nExecStartPre=-/bin/podman pull __CONTAINER_INFRA_PREFIX__heat-container-agent:__HEAT_CONTAINER_AGENT_TAG__\nExecStart=/bin/podman run \\\n        --name heat-container-agent \\\n        --privileged \\\n        --net=host \\\n        --volume /srv/magnum:/srv/magnum \\\n        --volume /opt/stack/os-config-refresh:/opt/stack/os-config-refresh \\\n        --volume /run/systemd:/run/systemd \\\n        --volume /etc/:/etc/ \\\n        --volume /var/lib:/var/lib \\\n        --volume /var/run:/var/run \\\n        --volume /var/log:/var/log \\\n        --volume /tmp:/tmp \\\n        --volume /dev:/dev \\\n        --env REQUESTS_CA_BUNDLE=/etc/pki/tls/certs/ca-bundle.crt \\\n        __CONTAINER_INFRA_PREFIX__heat-container-agent:__HEAT_CONTAINER_AGENT_TAG__ \\\n        /usr/bin/start-heat-container-agent\nTimeoutStartSec=10min\n\nExecStop=/bin/podman stop heat-container-agent\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "heat-container-agent.service"
      }
    ]
  }
}
